// Generated by CoffeeScript 1.3.3

$(function() {
  var $grid, $iframe, $searchInput, $tabs, DEFAULT_INTERVAL, clearGrid, gridRowTmpl, onDblClickRow, rewriteRows, search;
  $tabs = $('#tabs');
  $grid = $('#grid');
  $searchInput = $('#search_input');
  $iframe = $('#async_load_frame');
  gridRowTmpl = '<tr data-doc_id="{{ doc_id }}">\n<td class="column_no">{{ no }}</td>\n<td class="column_filename">{{ filename }}</td>\n<td class="column_size">{{ size }}</td>\n<td class="column_type">{{ content_type }}</td>\n<td class="column_created">{{ created }}</td>\n</tr>';
  DEFAULT_INTERVAL = 10;
  search = function() {
    var _query, _url;
    _url = '/list/search';
    _query = [];
    if (_query.length > 0) {
      _url += concreteQuery(_query);
    }
    return $.getJSON(_url, {}, function(json) {
      return rewriteRows(json);
    });
  };
  clearGrid = function() {
    return $grid.find('tbody>tr').off().remove();
  };
  rewriteRows = function(json) {
    var i;
    clearGrid();
    i = 0;
    return _.each(json, function(o) {
      var $tbdy;
      $tbdy = $grid.find('tbody');
      return (function(_o, _i) {
        return setTimeout(function() {
          return $tbdy.append(_.template(gridRowTmpl, _o));
        }, DEFAULT_INTERVAL * _i);
      })(o, i++);
    });
  };
  onDblClickRow = function(e) {
    var dblClicked, _form, _iframe,
      _this = this;
    dblClicked = $(e.currentTarget).data('doc_id');
    _iframe = document.createElement("iframe");
    _iframe.name = "hidden_frame";
    _iframe.style.display = "none";
    _iframe.onload = function() {};
    document.body.appendChild(_iframe);
    _form = document.createElement('form');
    _form.name = "hidden_form";
    _form.action = "/download/" + dblClicked;
    _form.target = _iframe.name;
    _form.style.display = "none";
    document.body.appendChild(_form);
    _form.submit();
    document.body.removeChild(_form);
    return daycrift.view.loadingDialog();
  };
  $searchInput.on('change', function(e) {});
  $iframe.on('load', function() {
    return search();
  });
  $grid.on('dblclick', 'tr', onDblClickRow);
  return search();
});
