// Generated by CoffeeScript 1.3.3

$(function() {
  var $grid, $iframe, $searchInput, $tabs, DEFAULT_INTERVAL, clearGrid, gridRowTmpl, onDblClickRow, rewriteRows, search;
  $tabs = $('#tabs');
  $grid = $('#grid');
  $searchInput = $('#search_input');
  $iframe = $('#async_load_frame');
  gridRowTmpl = '<tr>\n<td class="column_no">{{ no }}</td>\n<td class="column_filename">{{ filename }}</td>\n<td class="column_size">{{ size }}</td>\n<td class="column_type">{{ content_type }}</td>\n<td class="column_created">{{ created }}</td>\n</tr>';
  DEFAULT_INTERVAL = 100;
  search = function() {
    var _query, _url;
    _url = '/list/search';
    _query = [];
    if (_query.length > 0) {
      _url += concreteQuery(_query);
    }
    return $.getJSON(_url, {}, function(json) {
      return rewriteRows(json);
    });
  };
  clearGrid = function() {
    return $grid.find('tbody>tr').off().remove();
  };
  rewriteRows = function(json) {
    var i;
    clearGrid();
    i = 0;
    return _.each(json, function(o) {
      var $tbdy;
      $tbdy = $grid.find('tbody');
      return (function(_o, _i) {
        return setTimeout(function() {
          return $tbdy.append(_.template(gridRowTmpl, o));
        }, DEFAULT_INTERVAL * _i);
      })(o, i++);
    });
  };
  onDblClickRow = function() {
    return alert('show detail.');
  };
  $searchInput.on('change', function(e) {});
  $iframe.on('load', function() {
    return search();
  });
  $grid.on('dblclick', 'tr', onDblClickRow);
  return search();
});
